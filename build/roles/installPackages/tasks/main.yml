---
# tasks file for installPackages
- name: Install packages
  community.general.pacman:
    name:
      - amd-ucode
      - base
      - btrfs-progs
      - cloud-init
      - efibootmgr
      - efitools
      - efivar
      - fish
      - fisher
      - helm
      - jq
      - kubectl
      - libvirt
      - linux-hardened
      - linux-hardened-headers
      - lldpd
      - mlocate
      - nftables
      - nvme-cli
      - openssh
      - paxtest
      - pkgfile
      - python
      - sbctl
      - sbsigntools
      - sequoia-sq
      - sudo
      - vim
      - yq
      - zstd
    state: latest
    update_cache: true

- name: Gather the package facts
  ansible.builtin.package_facts:
    manager: pacman

- name: Write package list to /packages.yaml
  ansible.builtin.blockinfile:
    create: true
    path: /packages.yaml
    block: "{{ ansible_facts.packages }}"
    mode: 600

- name: Store file into ./packages.yaml
  ansible.builtin.fetch:
    src: /packages.yaml
    dest: ./packages.yaml
